<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Event</title>
    <link rel="icon" href="/Images/createEventIcon.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: url('/Images/event.jpg') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            position: relative;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 30%;
            height: auto;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: absolute;
            top: 10%;
            margin-top: 4%;
            left: 4%;
            z-index: 1;
            transition: background-color 0.4s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        .container:hover {
            transform: scale(1.05);

        }

        h1 {
            margin: 0;
            padding-bottom: 20px;
            -webkit-background-clip: text;
            background-clip: text;
            color: #120249;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.6),
                0 0 20px rgba(255, 255, 255, 0.7),
                0 0 30px rgba(255, 255, 255, 0.7);
        }

        label {
            display: block;
            margin: 10px 0 5px;
        }

        input,
        textarea {
            width: 90%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            transition: background-color 0.4 ease, transform 0.4s ease, box-shadow 0.3s ease;
        }

        textarea:hover,
        input:hover {
            transform: scale(1.03);
            border: 2px solid #180461;
        }

        button {
            width: 40%;
            padding: 10px;
            margin-top: 10%;
            background: linear-gradient(114.9deg, rgb(34, 34, 34) 8.3%, rgb(0, 40, 60) 41.6%, rgb(5, 78, 115) 93.4%);
            color: rgb(189, 180, 180);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.4s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        button:hover {
            background: linear-gradient(45deg, #255b27, #035213, #033801);
            transform: scale(1.08);
            color: #fff;
        }

        #3d-container {
            position: absolute;
            top: 0;
            right: 0;
            width: 75vw;
            height: 100vh;
            z-index: 0;
        }

    </style>
</head>

<body>
    <!-- Left side: Form container -->
    <div class="container">
        <h1>Create an EVENT</h1>
        <form id="createEventForm">
            <label for="eventTitle">Event Title:</label>
            <input type="text" id="eventTitle" required>

            <label for="eventDate">Event Date:</label>
            <input type="date" id="eventDate" required>

            <label for="eventDescription">Event Description:</label>
            <textarea id="eventDescription" rows="4" required></textarea>

            <label for="eventLocation">Event Location:</label>
            <input type="text" id="eventLocation">

            <input type="hidden" id="eventCreatedBy">

            <button type="submit">Create Event</button>
        </form>
        <p id="eventResponseMessage"></p>
    </div>

    <!--Earth 3D model container -->
    <div id="3d-container"></div>

    <script>
        // Assuming you have a way to get the logged-in user's username
        const loggedInUser = "adminUsername";
        document.getElementById('eventCreatedBy').value = loggedInUser;

        document.getElementById('createEventForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const newEvent = {
                title: document.getElementById('eventTitle').value,
                date: document.getElementById('eventDate').value,
                description: document.getElementById('eventDescription').value,
                location: document.getElementById('eventLocation').value,
                createdBy: document.getElementById('eventCreatedBy').value
            };

            // Fetch request for event creation
            fetch('http://localhost:8082/events', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newEvent)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('eventResponseMessage').textContent = `Event created successfully: ${data}`;
                    document.getElementById('createEventForm').reset(); // Reset the form after successful submission
                })
                .catch(error => {
                    document.getElementById('eventResponseMessage').textContent = `Error: ${error.message}`;
                });
        });

        // Initialize Flatpickr for date input
        document.addEventListener('DOMContentLoaded', function () {
            flatpickr("#eventDate", {
                dateFormat: "Y-m-d", // Customize the date format
                theme: "material_blue" // Optional theme customization
            });
        });

        // 3D Earth model setup
        let scene, camera, renderer, controls, earth;

        function init() {
            // Load the space texture
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load('/Images/space.jpg', function (texture) {
                const spaceGeometry = new THREE.SphereGeometry(1000, 64, 64);
                const spaceMaterial = new THREE.MeshBasicMaterial({
                    map: texture,
                    side: THREE.BackSide
                });
                const spaceSphere = new THREE.Mesh(spaceGeometry, spaceMaterial);
                scene.add(spaceSphere);
            });

            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0d0d1f);
            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 5000);
            camera.position.set(800, 200, 1000);

            const hemisphereLight = new THREE.HemisphereLight(0xaaaaaa, 0x444444, 1);
            hemisphereLight.position.set(0, 200, 0);
            scene.add(hemisphereLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(100, 200, 100);
            scene.add(directionalLight);

            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);

            const spotLight = new THREE.SpotLight(0xffffff, 1.2);
            spotLight.position.set(300, -200, 500);
            spotLight.castShadow = true;
            spotLight.angle = Math.PI / 6;
            spotLight.penumbra = 0.5;
            scene.add(spotLight);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('3d-container').appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enableZoom = true;
            controls.maxPolarAngle = Math.PI / 2;

            let loader = new THREE.GLTFLoader();
            loader.load('scene.gltf', function (gltf) {
                earth = gltf.scene.children[0];
                earth.scale.set(0.08, 0.08, 0.08);
                earth.position.x += 320;
                earth.position.y += 30;
                scene.add(gltf.scene);
                animate();
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            if (earth) {
                earth.rotation.z += 0.002;
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>

</body>

</html>